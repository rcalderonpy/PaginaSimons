<?php

namespace ContabilidadBundle\Repository;


/**
 * VentaSinRepository
 *
 * This class was generated by the Doctrine ORM. Add your own custom
 * repository methods below.
 */


class VentaSinRepository extends \Doctrine\ORM\EntityRepository
{
    public function getIVA10($ii10)
    {
        $iva10=round(($ii10/11),0);
        return $iva10;
    }

    public function filtrarVentas($opciones=array(
        'cliente'=>0
    ))
    {
        $em=$this->getEntityManager();

        $query=$em->createQueryBuilder()
            ->select('v')
            ->from('ContabilidadBundle:VentaSin', 'v')
            ->Where("v.cliente = :cliente")
            ->setParameter('cliente', $opciones['cliente'])
            ->orderBy('v.fecha', 'ASC')
            ->getQuery();

        $ventas=$query->getResult();
        return $ventas;
    }

    public function filtrarVentasPeriodo($opciones=array(
        'cliente'=>0,
        'mes',
        'ano'
    ))
    {
        $em=$this->getEntityManager();

        $query = $em->createQuery('SELECT v FROM ContabilidadBundle:Ventasin v WHERE v.cliente=?1 AND MONTH(v.fecha)=?2 AND YEAR(v.fecha)=?3');
        $query->setParameter(1, $opciones['cliente']);
        $query->setParameter(2, $opciones['mes']);
        $query->setParameter(3, $opciones['ano']);

        $resultado=$query->getResult();
        return $resultado;
    }

    public function totalesVentas($opciones=array(
        'cliente'=>0,
        'mes',
        'ano'
    ))
    {
        $em=$this->getEntityManager();

        $query=$em->createQueryBuilder()
            ->select('count(1) as cantidad, sum(v.g10+v.g5+v.iva10+v.iva5+v.exe) as suma')
            ->from('ContabilidadBundle:VentaSin', 'v')
            ->Where("v.cliente = :cliente")
            ->andWhere("month(v.fecha) = :mes")
            ->andWhere("year(v.fecha) = :ano")
            ->setParameter('cliente', $opciones['cliente'])
            ->setParameter('mes', $opciones['mes'])
            ->setParameter('ano', $opciones['ano'])
            ->getQuery();

        $ventas=$query->getResult();
        return $ventas;
    }
}
